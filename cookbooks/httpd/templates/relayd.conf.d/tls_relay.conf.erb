tls_opts = "edh params auto, no tlsv1.0, session tickets"

http protocol www_tls {
    tcp { nodelay, sack, socket buffer 65536, backlog 128 }
    tls { keypair <%= node.fqdn %>, $tls_opts }
<%- @domains.each do |domain| %>
    tls { keypair <%= domain %>, $tls_opts }
<%- end %>

    match header set "X-Forwarded-For" \
        value "$REMOTE_ADDR"
    match header set "X-Forwarded-By" \
        value "$SERVER_ADDR:$SERVER_PORT"
    match header set "Keep-Alive" value "$TIMEOUT"
    pass

}

relay www_tls {
    listen on $ext_if port 443 tls
    protocol www_tls

    forward to <httpd> port $redirect_port 
    #check http "/" host "_healthcheck" code 200
}
